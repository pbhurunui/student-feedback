<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Feedback Comparison Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load D3.js for visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        /* Custom styles for the chalkboard aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .chalkboard-card {
            background-color: #2c3e50; /* Dark slate blue */
            color: #ecf0f1; /* Off-white for "chalk" text */
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        .chalkboard-header {
            color: #f39c12; /* Bright orange for emphasis */
            font-size: 1.5rem;
            font-weight: 700;
        }
        /* Style for the bar charts */
        .bar { fill: #3498db; }
        .bar-t1 { fill: #3498db; } /* Blue for T1 */
        .bar-t3 { fill: #2ecc71; } /* Green for T3 */
        .axis text { fill: #ecf0f1; }
        .axis path, .axis line { stroke: #ecf0f1; }

        /* Custom scrollbar for comment sections */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-7xl mx-auto space-y-8">
        <header class="text-center py-6">
            <h1 class="text-4xl font-extrabold text-gray-800">Student Feedback Analysis</h1>
            <p class="text-xl text-gray-500 mt-2">Term 1 vs. Term 3 Comparative View</p>
        </header>

        <!-- Loading Indicator -->
        <div id="loading" class="text-center p-8 text-xl font-medium">
            Processing feedback data...
        </div>

        <!-- Summary & Totals -->
        <div id="summary-cards" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="chalkboard-card p-6 text-center">
                <p class="chalkboard-header text-3xl" id="total-t1">0</p>
                <p class="text-sm text-gray-400 mt-1">T1 Responses</p>
            </div>
            <div class="chalkboard-card p-6 text-center">
                <p class="chalkboard-header text-3xl" id="total-t3">0</p>
                <p class="text-sm text-gray-400 mt-1">T3 Responses</p>
            </div>
            <div class="chalkboard-card p-6 text-center">
                <p class="chalkboard-header text-3xl" id="total-combined">0</p>
                <p class="text-sm text-gray-400 mt-1">Total Responses</p>
            </div>
        </div>

        <!-- Quantitative Comparison Charts -->
        <div id="quantitative-charts" class="hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Quantitative Comparison (T1 vs T3)</h2>
            <div id="chart-container" class="space-y-8">
                <!-- Charts will be injected here -->
            </div>
        </div>

        <!-- Qualitative Comments Section -->
        <div id="qualitative-comments" class="hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Qualitative Feedback</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                <!-- Constructive Feedback -->
                <div class="chalkboard-card p-6 space-y-4">
                    <h3 class="chalkboard-header text-xl border-b border-gray-600 pb-2">
                        What Could Be Improved (T1 & T3)
                    </h3>
                    <div id="improvement-comments" class="custom-scrollbar h-96 overflow-y-auto space-y-3 pr-2">
                        <!-- Comments will be injected here -->
                    </div>
                    <p id="improvement-count" class="text-xs text-gray-500 pt-2"></p>
                </div>

                <!-- Positive Feedback -->
                <div class="chalkboard-card p-6 space-y-4">
                    <h3 class="chalkboard-header text-xl border-b border-gray-600 pb-2">
                        What Students Like Most (T1 & T3)
                    </h3>
                    <div id="positive-comments" class="custom-scrollbar h-96 overflow-y-auto space-y-3 pr-2">
                        <!-- Comments will be injected here -->
                    </div>
                    <p id="positive-count" class="text-xs text-gray-500 pt-2"></p>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- DATA EMBEDDING (Term 1 & Term 3 CSVs) ---

        // Term 1 Data (Student Feedback 2025 T1)
        const csvDataT1 = `Timestamp,What do I teach you?,How clearly do I explain the lessons?,How interesting are the lessons?,Do I use different ways to explain things? e.g. videos/activities/examples,Do I encourage you to ask questions or participate in class?,"How much do you enjoy participating in class activities? e.g. pair work, group work, class discussions",Do I make learning engaging and enjoyable?,How quickly do I give feedback on work or assignments?,Do I help you when you don’t understand something? ,How comfortable do you feel asking for help in class?,Do I create an environment where you feel safe and heard?,What do you like most about how I teach?,What do you think could be improved about how I teach?,Any other comments or suggestions for me?
04/03/2025 15:43:06,Music,Clear,Interesting,Always,Always,A Lot,Often,Very Quickly,Always,Very Comfortable,Always,"How comfortable it is. It's not a scary environment. The music room is just really chill and Phil is also great to be around and have as a teacher.",Nothing,Favourite teacher for sure 
04/03/2025 22:05:45,Ako,Very Clear,Neutral,Often,Sometimes,A Lot,Often,Quickly,Always,Comfortable,Often,Friendly and relatable,Not sure,No
05/03/2025 09:18:13,Music,Clear,Interesting,Often,Always,Often,A Lot,Very Quickly,Always,Very Comfortable,Always,"Always help, and engaging",nothing,no
05/03/2025 09:29:21,"Music",Clear,Interesting,Sometimes,Often,Often,Often,Quickly,Always,Comfortable,Always,"you think of things in a teens  pov so it helps us understand better ","i dont think anything needs to be inproved, you could maybe be strickter on kids who arnt doing as theyere asked but then they might not like you lol",no :) i think your great 
06/03/2025 09:29:55,Ako,Clear,Very Interesting,Often,Always,A Lot,A Lot,On Time,Always,Very Comfortable,Always,"You are very straightforward and don't mess about. You just get what needs to be done, done.","Not much, you are a great Ako teacher :)",Nope
11/03/2025 14:23:54,Music,Okay,Interesting,Often,Sometimes,A Little,A Lot,On Time,Sometimes,Comfortable,Often,practical,"use text books or something on how to read music",nope
12/03/2025 12:57:30,Music,Clear,Very Interesting,Often,Often,Often,A Lot,On Time,Sometimes,Very Comfortable,Always,I enjoy the practicals and sometimes the theory. ,-,-
14/03/2025 11:49:33,Music,Very Clear,Very Interesting,Always,Often,A Lot,Often,Quickly,Sometimes,Not Comfortable,Always,everything,nothing , let me game more in class ands not do any lreaning 
26/03/2025 12:50:51,Music,Very Clear,Very Interesting,Always,Always,A Lot,Always,Very Quickly,Always,Very Comfortable,Always,I enjoy your class and the way you teach music. ,Nothing , No other comments.
26/03/2025 12:51:24,Music,Very Clear,Very Interesting,Always,Always,A Lot,Always,Very Quickly,Always,Very Comfortable,Always,"I like how you teach music, and the practical work we do is very fun and engaging.","No, you are a great teacher!",No
26/03/2025 12:52:13,Music,Clear,Interesting,Often,Always,A Lot,Often,Quickly,Always,Very Comfortable,Always,"I like that you are helpful, easy to talk to and you encourage me to ask questions.",I don’t know,-
26/03/2025 12:52:30,Music,Clear,Interesting,Sometimes,Often,Often,Often,On Time,Often,Comfortable,Often,"I like that you are clear when teaching, and you are very encouraging and kind.","nothing really, maybe a bit more practical work",no
26/03/2025 12:53:30,Music,Clear,Interesting,Often,Often,Often,Often,Quickly,Always,Comfortable,Always,"You are very helpful, and are straight to the point.","A little bit more practical work.",No
26/03/2025 12:54:15,Music,Clear,Interesting,Sometimes,Often,Often,Often,On Time,Often,Comfortable,Often,"I like that you are clear when teaching, and you are very encouraging and kind.","nothing really, maybe a bit more practical work",no
26/03/2025 12:55:04,Music,Clear,Neutral,Sometimes,Often,A Little,Often,On Time,Always,Comfortable,Always,"You are very helpful, and are straight to the point.",A little bit more practical work.,No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,Often,Often,Very Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
26/03/2025 12:55:04,Digital Technology,Very Clear,Very Interesting,Always,Always,A Lot,Always,Very Quickly,Always,Very Comfortable,Always,"You're fun, clear, and good at teaching.",Nothing,No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,Often,A Lot,Very Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,A Lot,Often,Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,Often,Often,Very Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,A Lot,Often,Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,Often,Often,Very Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
26/03/2025 12:55:04,Music,Clear,Interesting,Often,Always,A Lot,Often,Quickly,Always,Very Comfortable,Always,"You are always very helpful, and always make sure we understand the work.","Maybe a bit more practical work.",No
`;

        // Term 3 Data (Student Feedback 2025 T3)
        const csvDataT3 = `Timestamp,What do I teach you?,How clearly do I explain the lessons?,How interesting are the lessons?,Do I use different ways to explain things? e.g. videos/activities/examples,Do I encourage you to ask questions or participate in class?,"How much do you enjoy participating in class activities? e.g. pair work, group work, class discussions",Do I make learning engaging and enjoyable?,How quickly do I give feedback on work or assignments?,Do I help you when you don’t understand something? ,How comfortable do you feel asking for help in class?,Do I create an environment where you feel safe and heard?,What do you like most about how I teach?,What do you think could be improved about how I teach?,Any other comments or suggestions for me?
07/10/2025 16:19:25,Music,Clear,Interesting,Often,Always,Often,A Lot,Very Quickly,Always,Very Comfortable,Always,How supportive you are,Nothing,Nope
07/10/2025 16:29:02,"Ako, Music",Clear,Neutral,Often,Often,Often,Often,Very Quickly,Always,Very Comfortable,Always,"U are straight to the point and short and clear on explaining things",Unsure,"Very quick to get back results and feedback "
07/10/2025 16:30:41,Music,Very Clear,Interesting,Sometimes,Often,Sometimes,Often,Very Quickly,Often,Very Comfortable,Always,"How approachable and respectful you are to students. Treated like equals and how understanding you are.","Certain days, certain topics in classes.",Nah
07/10/2025 16:31:02,Digital Technology,Clear,Interesting,Always,Always,A Lot,A Lot,Quickly,Always,Very Comfortable,Always,Your very fun in the activaties that you do.,Not much but you could do more stuff  outside,no
13/10/2025 12:21:56,Digital Technology,Clear,Neutral,Always,Often,Often,Sometimes,Quickly,Often,Very Comfortable,Always,"the way you make it exciting","you dont have to inprove ",no
15/10/2025 10:06:01,Music,Clear,Interesting,Always,Often,Often,Often,On Time,Often,Very Comfortable,Often,"That you actually spend time with us.","no",no
15/10/2025 14:07:22,Music,Very Clear,Interesting,Often,Always,A Lot,A Lot,Very Quickly,Often,Very Comfortable,Always,"How much practical time we get, and the practical assesments, like how we have to change a songs genre. I think it's interesting and creative.","checking in to see if the groups need help slightly more often.",Nope
15/10/2025 14:45:30,"Music, Digital Technology",Clear,Interesting,Sometimes,Always,A Lot,Often,Very Quickly,Always,Very Comfortable,Always,"your laid back and you always try to see our point of views and if we don't understand you always try to explain it in a different way so we do understand  ","maybe have more fun activities that are to do with learning espily with theory, like when we did quizlet, that was fun and engaging and it helped me and others learn a lot of theory...","nothing else, you are a great teacher..."
`;

        // --- GLOBAL CONFIGURATION AND UTILITIES ---

        const ratingMap = {
            // Rating scales for quantitative analysis
            'Very Clear': 5, 'Clear': 4, 'Okay': 3, 'A Little Unclear': 2, 'Unclear': 1,
            'Very Interesting': 5, 'Interesting': 4, 'Neutral': 3, 'A Little Uninteresting': 2, 'Boring': 1,
            'Always': 5, 'Often': 4, 'Sometimes': 3, 'Rarely': 2, 'Never': 1,
            'A Lot': 5, 'Often': 4, 'A Little': 3, 'Sometimes': 2, 'Not Much': 1,
            'Very Quickly': 5, 'Quickly': 4, 'On Time': 3, 'Slowly': 2, 'Very Slowly': 1,
            'Very Comfortable': 5, 'Comfortable': 4, 'Neutral': 3, 'Not Comfortable': 2, 'Very Uncomfortable': 1,
        };

        const quantitativeQuestions = [
            'How clearly do I explain the lessons?',
            'How interesting are the lessons?',
            'Do I make learning engaging and enjoyable?',
            'How quickly do I give feedback on work or assignments?',
            'Do I create an environment where you feel safe and heard?'
        ];

        const qualitativeQuestions = {
            'positive': 'What do you like most about how I teach?',
            'improvement': 'What do you think could be improved about how I teach?'
        };

        const IGNORE_IMPROVEMENT_COMMENTS = [
            "no", "none", "nothing", "unsure", "nope", "-", "n/a", "na",
            "not sure", "not much", "you don't have to inprove" // Common noise, normalized to lowercase
        ];

        /**
         * Parses CSV data into an array of objects.
         * Handles quoted fields and skips the header.
         * @param {string} csvString - The raw CSV string.
         * @returns {Array<Object>} The parsed data array.
         */
        function parseCSV(csvString) {
            const data = d3.csvParse(csvString.trim());
            return data;
        }

        /**
         * Cleans, processes, and aggregates the feedback data.
         * @param {Array<Object>} rawDataT1 - Parsed T1 data.
         * @param {Array<Object>} rawDataT3 - Parsed T3 data.
         * @returns {Object} Processed analysis data.
         */
        function processData(rawDataT1, rawDataT3) {
            const dataSets = {
                T1: rawDataT1,
                T3: rawDataT3
            };
            const analysis = {
                totals: { T1: rawDataT1.length, T3: rawDataT3.length, combined: rawDataT1.length + rawDataT3.length },
                quantitative: [],
                qualitative: { positive: [], improvement: [] }
            };

            // 1. Quantitative Analysis
            quantitativeQuestions.forEach(question => {
                const results = { question: question, T1: 0, T3: 0, T1Count: 0, T3Count: 0 };

                ['T1', 'T3'].forEach(term => {
                    let totalScore = 0;
                    let validCount = 0;
                    const data = dataSets[term];

                    data.forEach(row => {
                        const ratingText = row[question];
                        const score = ratingMap[ratingText];
                        if (score) {
                            totalScore += score;
                            validCount++;
                        }
                    });

                    results[term] = validCount > 0 ? (totalScore / validCount) : 0;
                    results[`${term}Count`] = validCount;
                });
                analysis.quantitative.push(results);
            });

            // 2. Qualitative Analysis
            const allData = rawDataT1.concat(rawDataT3.map(d => ({ ...d, term: 'T3' })));

            allData.forEach(row => {
                const term = row.term || (rawDataT1.includes(row) ? 'T1' : 'T3');
                const positiveText = (row[qualitativeQuestions.positive] || '').trim();
                const improvementText = (row[qualitativeQuestions.improvement] || '').trim();

                // Process POSITIVE Feedback
                if (positiveText.length > 2) {
                    analysis.qualitative.positive.push({
                        text: positiveText,
                        term: term,
                        subject: row['What do I teach you?'] || 'N/A'
                    });
                }

                // Process IMPROVEMENT Feedback (CRITICAL FILTER REVISION)
                if (improvementText.length > 2) {
                    const cleanedText = improvementText.toLowerCase().replace(/[^a-z0-9\s]/g, '');

                    // Check if the cleaned text is one of the common non-constructive noise phrases
                    const isNoise = IGNORE_IMPROVEMENT_COMMENTS.some(noise => cleanedText === noise);

                    if (!isNoise) {
                        analysis.qualitative.improvement.push({
                            text: improvementText,
                            term: term,
                            subject: row['What do I teach you?'] || 'N/A'
                        });
                    }
                }
            });

            return analysis;
        }

        /**
         * Renders the qualitative comments into the designated containers.
         * @param {Object} analysis - The processed analysis data.
         */
        function renderQualitativeComments(analysis) {
            const renderComments = (containerId, comments, isImprovement) => {
                const container = document.getElementById(containerId);
                const countElement = document.getElementById(`${containerId.split('-')[0]}-count`);
                container.innerHTML = '';

                comments.sort((a, b) => b.term.localeCompare(a.term)); // Sort T3 first, then T1

                comments.forEach(c => {
                    const termColor = c.term === 'T3' ? 'bg-green-600' : 'bg-blue-600';
                    const sentimentIcon = isImprovement ? '⚙️' : '🌟';

                    const commentHtml = `
                        <div class="p-3 rounded-lg border border-gray-700 bg-gray-800 shadow-lg">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-semibold text-gray-300 flex items-center">
                                    ${sentimentIcon} ${c.subject}
                                </span>
                                <span class="text-xs font-mono px-2 py-0.5 rounded ${termColor}">${c.term}</span>
                            </div>
                            <p class="text-sm italic">${c.text}</p>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', commentHtml);
                });

                countElement.textContent = `Total relevant comments: ${comments.length}`;
            };

            renderComments('improvement-comments', analysis.qualitative.improvement, true);
            renderComments('positive-comments', analysis.qualitative.positive, false);
        }

        /**
         * Renders a single grouped bar chart for a quantitative question.
         * @param {Object} data - The data for a single question.
         */
        function renderGroupedBarChart(data) {
            const margin = { top: 20, right: 20, bottom: 30, left: 100 };
            const container = document.getElementById('chart-container');
            const chartDiv = document.createElement('div');
            chartDiv.id = `chart-${data.question.replace(/\s/g, '-')}`;
            chartDiv.className = 'chalkboard-card p-6';
            container.appendChild(chartDiv);

            // Responsive sizing: full width on mobile, max 700px on desktop
            const width = Math.min(chartDiv.clientWidth - margin.left - margin.right, 700);
            const height = 150 - margin.top - margin.bottom;

            const svg = d3.select(`#${chartDiv.id}`)
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom + 20) // +20 for bottom labels
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Title
            d3.select(`#${chartDiv.id}`).insert('h3', 'svg')
                .attr('class', 'chalkboard-header text-lg mb-4')
                .text(data.question);

            // Data structure for D3
            const chartData = [
                { term: 'T1', mean: data.T1, count: data.T1Count },
                { term: 'T3', mean: data.T3, count: data.T3Count }
            ];

            // Scales
            const x = d3.scaleBand()
                .domain(['T1', 'T3'])
                .range([0, width])
                .padding(0.2);

            // Max mean score is 5 (5=Always, Very Clear, etc.)
            const y = d3.scaleLinear()
                .domain([0, 5])
                .range([height, 0]);

            // Axes
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => d.toFixed(1)));

            // Bars
            svg.selectAll(".bar")
                .data(chartData)
                .enter().append("rect")
                .attr("class", d => `bar-${d.term.toLowerCase()}`)
                .attr("x", d => x(d.term))
                .attr("y", d => y(d.mean))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.mean))
                .on("mouseover", function(event, d) {
                    d3.select(this).style("fill", "#f39c12"); // Highlight on hover
                    // Tooltip display
                    svg.append("text")
                        .attr("class", "mean-label")
                        .attr("x", x(d.term) + x.bandwidth() / 2)
                        .attr("y", y(d.mean) - 5)
                        .attr("text-anchor", "middle")
                        .attr("fill", "#ecf0f1")
                        .attr("font-size", "12px")
                        .text(`${d.mean.toFixed(2)} (n=${d.count})`);
                })
                .on("mouseout", function(event, d) {
                    d3.select(this).style("fill", d.term === 'T1' ? '#3498db' : '#2ecc71'); // Revert color
                    svg.selectAll(".mean-label").remove(); // Remove tooltip
                });

            // Y-Axis Label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 15)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .attr("fill", "#ecf0f1")
                .style("text-anchor", "middle")
                .text("Mean Score (1 - 5)");
        }


        // --- MAIN EXECUTION LOGIC ---
        window.onload = function() {
            try {
                // 1. Parse and Process Data
                const rawT1 = parseCSV(csvDataT1);
                const rawT3 = parseCSV(csvDataT3);
                const analysis = processData(rawT1, rawT3);

                // 2. Update Summary Totals
                document.getElementById('total-t1').textContent = analysis.totals.T1;
                document.getElementById('total-t3').textContent = analysis.totals.T3;
                document.getElementById('total-combined').textContent = analysis.totals.combined;

                // 3. Render Quantitative Charts
                analysis.quantitative.forEach(renderGroupedBarChart);

                // 4. Render Qualitative Comments
                renderQualitativeComments(analysis);

                // 5. Show Dashboard Content
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('summary-cards').classList.remove('hidden');
                document.getElementById('quantitative-charts').classList.remove('hidden');
                document.getElementById('qualitative-comments').classList.remove('hidden');

            } catch (error) {
                console.error("An error occurred during data processing or rendering:", error);
                document.getElementById('loading').textContent = 'Error loading dashboard. Check console for details.';
            }
        };
    </script>

</body>
</html>
