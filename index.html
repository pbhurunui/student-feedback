<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Feedback Analysis Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use a simple, clear font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the blackboard look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a; /* Very dark charcoal/blackboard color */
        }
        .blackboard-bg {
            background-color: #224229; /* Deep green for the board surface */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
            border-radius: 1rem;
            border: 10px solid #795548; /* Wood frame color */
        }
        .chalk-text {
            color: #fffbe6; /* Off-white, chalk color */
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.2);
        }
        .chalk-heading {
            border-bottom: 2px dashed #90a4ae; /* Light gray chalk line */
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .score-box {
            background-color: rgba(255, 255, 255, 0.1); /* Slightly lighter chalk box */
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="dashboard" class="blackboard-bg max-w-6xl mx-auto p-6 md:p-10">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold chalk-text mb-2">Student Feedback Analysis</h1>
            <p class="text-xl chalk-text font-light">Term 1 vs Term 3 Performance Review (2025)</p>
        </header>

        <!-- Main Dashboard Content -->
        <div id="main-content" class="space-y-12">

            <!-- 1. Overall Performance Comparison -->
            <section>
                <h2 class="text-3xl font-bold chalk-text chalk-heading">1. Overall Term-Over-Term Comparison (1-5 Scale)</h2>
                <div id="overall-scores" class="overflow-x-auto">
                    <!-- Table will be injected here -->
                </div>
            </section>

            <!-- 2. Subject-Specific Averages -->
            <section>
                <h2 class="text-3xl font-bold chalk-text chalk-heading">2. Subject-Specific Trends</h2>
                <div id="subject-trends" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Cards will be injected here -->
                </div>
            </section>

            <!-- 3. Qualitative Insights -->
            <section>
                <h2 class="text-3xl font-bold chalk-text chalk-heading">3. Qualitative Insights (Top Themes)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Positive Feedback Card -->
                    <div class="score-box p-6 rounded-xl">
                        <h3 class="text-xl font-semibold chalk-text mb-4 text-yellow-300">üëç What Students Like Most</h3>
                        <ul id="positive-feedback-list" class="list-disc list-inside space-y-2 chalk-text ml-4">
                            <!-- Items will be injected here -->
                        </ul>
                    </div>
                    <!-- Improvement Feedback Card -->
                    <div class="score-box p-6 rounded-xl">
                        <h3 class="text-xl font-semibold chalk-text mb-4 text-red-300">üí° Areas for Improvement</h3>
                        <ul id="improvement-feedback-list" class="list-disc list-inside space-y-2 chalk-text ml-4">
                            <!-- Items will be injected here -->
                        </ul>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <script>
        // Data structure derived from the analysis in feedback_analysis.py
        const data = {
            // Overall Averages (based on the overall_term_averages.csv output)
            overallMetrics: [
                { metric: 'Overall Score', t1: 4.31, t3: 4.39, color: 'text-yellow-300' },
                { metric: 'Clarity of Lessons', t1: 4.09, t3: 4.25, color: 'text-green-300' },
                { metric: 'Student Comfort (Asking for Help)', t1: 4.17, t3: 4.33, color: 'text-blue-300' },
                { metric: 'Engagement/Enjoyment', t1: 4.21, t3: 4.17, color: 'text-red-300' },
                { metric: 'Feedback Speed', t1: 4.38, t3: 4.50, color: 'text-pink-300' }
            ],

            // Subject-Specific Averages (from subject_term_averages.csv)
            subjectAverages: [
                { subject: 'Music', term: 'T1 2025', score: 4.35, lowArea: 'Clarity' },
                { subject: 'Music', term: 'T3 2025', score: 4.41, lowArea: 'Encouragement' },
                { subject: 'Ako', term: 'T1 2025', score: 4.20, lowArea: 'Participation Enjoyment' },
                { subject: 'Ako', term: 'T3 2025', score: 4.35, lowArea: 'Participation Enjoyment' },
                { subject: 'Digital Tech', term: 'T3 2025', score: 4.38, lowArea: 'Participation Enjoyment' }
            ],

            // Qualitative Feedback (from the Top Word Frequency section)
            qualitative: {
                positive: [
                    'Approachability & Support',
                    'Clear and Concise Explanation',
                    'Fun and Practical Time',
                    'Engaging Activities',
                    'Being Treated Like Equals'
                ],
                improvement: [
                    'Request for more Activities/Practicals',
                    'More Engaging Methods for Theory',
                    'Group Check-ins slightly more often',
                    'Need for variety in certain topics'
                ]
            }
        };

        const renderOverallScores = () => {
            const container = document.getElementById('overall-scores');
            let tableHTML = `
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="chalk-text text-lg border-b border-gray-500">
                            <th class="p-3 font-bold">Metric (Score 1-5)</th>
                            <th class="p-3 font-bold text-center">Term 1 (Avg)</th>
                            <th class="p-3 font-bold text-center">Term 3 (Avg)</th>
                            <th class="p-3 font-bold text-center">Change</th>
                            <th class="p-3 font-bold">Trend</th>
                        </tr>
                    </thead>
                    <tbody class="chalk-text text-base">
            `;

            data.overallMetrics.forEach(item => {
                const change = (item.t3 - item.t1).toFixed(2);
                const trendIcon = change > 0 ? '‚ñ≤' : (change < 0 ? '‚ñº' : '‚ñ¨');
                const trendColor = change > 0 ? 'text-green-400' : (change < 0 ? 'text-red-400' : 'text-gray-400');
                const backgroundColor = item.t3 > item.t1 ? 'bg-green-800/20' : 'bg-red-800/20';


                tableHTML += `
                    <tr class="border-b border-gray-600 hover:${backgroundColor}">
                        <td class="p-3 font-semibold ${item.color}">${item.metric}</td>
                        <td class="p-3 text-center">${item.t1.toFixed(2)}</td>
                        <td class="p-3 text-center font-bold ${item.t3 > item.t1 ? 'text-yellow-300' : ''}">${item.t3.toFixed(2)}</td>
                        <td class="p-3 text-center ${trendColor}">${change}</td>
                        <td class="p-3 text-center ${trendColor} text-xl">${trendIcon}</td>
                    </tr>
                `;
            });

            tableHTML += `</tbody></table>`;
            container.innerHTML = tableHTML;
        };

        const renderSubjectTrends = () => {
            const container = document.getElementById('subject-trends');
            container.innerHTML = ''; // Clear existing content

            // Group by Subject for presentation
            const subjects = data.subjectAverages.reduce((acc, current) => {
                acc[current.subject] = acc[current.subject] || [];
                acc[current.subject].push(current);
                return acc;
            }, {});

            for (const subject in subjects) {
                const terms = subjects[subject];
                
                // Get the latest score and lowest area
                const latest = terms[terms.length - 1];
                const latestScore = latest.score.toFixed(2);
                const lowestArea = latest.lowArea;
                
                // Calculate the term change if possible
                let changeIndicator = '';
                if (terms.length > 1) {
                    const t1Score = terms.find(t => t.term.includes('T1'))?.score;
                    const t3Score = latest.score;
                    if (t1Score) {
                        const change = (t3Score - t1Score).toFixed(2);
                        const trend = change > 0 ? `<span class="text-green-400">‚ñ≤ +${change}</span>` : `<span class="text-red-400">‚ñº ${change}</span>`;
                        changeIndicator = `<p class="text-sm chalk-text mt-1">T1 vs T3: ${trend}</p>`;
                    }
                }

                // Card Structure
                const cardHTML = `
                    <div class="score-box p-6 rounded-xl hover:ring-4 hover:ring-yellow-500/50 transition duration-300">
                        <h3 class="text-2xl font-bold chalk-text mb-3 text-blue-300">${subject} (${latest.term})</h3>
                        <p class="text-5xl font-extrabold ${latestScore >= 4.3 ? 'text-yellow-300' : 'text-orange-300'}">${latestScore}</p>
                        ${changeIndicator}
                        <div class="mt-4 pt-3 border-t border-gray-600">
                            <p class="text-sm font-light chalk-text mb-1">Area to Watch:</p>
                            <p class="text-lg font-semibold text-red-300">${lowestArea}</p>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHTML;
            }
        };

        const renderQualitativeFeedback = () => {
            const renderList = (id, items) => {
                const container = document.getElementById(id);
                container.innerHTML = items.map(item => `<li class="text-lg">${item}</li>`).join('');
            };

            renderList('positive-feedback-list', data.qualitative.positive);
            renderList('improvement-feedback-list', data.qualitative.improvement);
        };

        // Initialize dashboard when the window loads
        window.onload = () => {
            renderOverallScores();
            renderSubjectTrends();
            renderQualitativeFeedback();
        };

    </script>
</body>
</html>
